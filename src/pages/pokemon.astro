---
import PokemonComponent from "../components/ui/pokemon/PokemonComponent";
import learnsetsDiff from "../data/learnsets_diff.json";
import mons from "../data/pokemon.json";
import Layout from "../layouts/Layout.astro";
import type { LearnsetData } from "../models/types/learnset.data";
import { PokemonFlags, type PokemonInfo } from "../models/types/pokemon.info";
const learnsetsData = learnsetsDiff as LearnsetData[];
function getLearnset(pokemon: string) {
  return learnsetsData.find((ls) => ls.pokemon === pokemon);
}

const monsBlacklist = [
  "DUDUNSPARCE_THREE_SEGMENT",
  "WORMADAM_SANDY_CLOAK",
  "WORMADAM_TRASH_CLOAK",
  "BURMY_SANDY_CLOAK",
  "BURMY_TRASH_CLOAK",
  "SHELLOS_EAST_SEA",
  "GASTRODON_EAST_SEA",
  "DEOXYS_ATTACK",
  "DEOXYS_DEFENSE",
  "DEOXYS_SPEED",
  "ROTOM_MOW",
  "ROTOM_FAN",
  "ROTOM_HEAT",
  "ROTOM_WASH",
  "ROTOM_FROST",
  "DIALGA_ORIGIN",
  "PALKIA_ORIGIN",
  "GIRATINA_ORIGIN",
  "SHAYMIN_SKY",
  "BASCULIN_BLUE_STRIPED",
  "BASCULIN_WHITE_STRIPED",
  "DARMANITAN_ZEN_MODE",
  "DEERLING_SUMMER",
  "DEERLING_WINTER",
  "DEERLING_AUTUMN",
  "SAWSBUCK_SUMMER",
  "SAWSBUCK_WINTER",
  "SAWSBUCK_AUTUMN",
  "TORNADUS_THERIAN",
  "THUNDURUS_THERIAN",
  "LANDORUS_THERIAN",
  "KYUREM_WHITE",
  "KYUREM_BLACK",
  "KELDEO_RESOLUTE",
  "MELOETTA_PIROUETTE",
  "VIVILLON_POLAR",
  "VIVILLON_TUNDRA",
  "VIVILLON_CONTINENTAL",
  "VIVILLON_GARDEN",
  "VIVILLON_ELEGANT",
  "VIVILLON_MEADOW",
  "VIVILLON_MODERN",
  "VIVILLON_MARINE",
  "VIVILLON_ARCHIPELAGO",
  "VIVILLON_HIGH_PLAINS",
  "VIVILLON_SANDSTORM",
  "VIVILLON_RIVER",
  "VIVILLON_MONSOON",
  "VIVILLON_SAVANNA",
  "VIVILLON_SUN",
  "VIVILLON_OCEAN",
  "VIVILLON_JUNGLE",
  "VIVILLON_FANCY",
  "VIVILLON_POKE_BALL",
  "FURFROU_HEART_TRIM",
  "FURFROU_STAR_TRIM",
  "FURFROU_DIAMOND_TRIM",
  "FURFROU_DEBUTANTE_TRIM",
  "FURFROU_MATRON_TRIM",
  "FURFROU_DANDY_TRIM",
  "FURFROU_LA_REINE_TRIM",
  "FURFROU_KABUKI_TRIM",
  "FURFROU_PHARAOH_TRIM",
  "AEGISLASH_BLADE",
  "PUMPKABOO_SMALL",
  "PUMPKABOO_LARGE",
  "PUMPKABOO_SUPER",
  "GOURGEIST_SMALL",
  "GOURGEIST_LARGE",
  "GOURGEIST_SUPER",
  "XERNEAS_ACTIVE",
  "ZYGARDE_10_PERCENT",
  "ZYGARDE_COMPLETE",
  "HOOPA_UNBOUND",
  "MINIOR_METEOR_ORANGE",
  "MINIOR_METEOR_YELLOW",
  "MINIOR_METEOR_GREEN",
  "MINIOR_METEOR_BLUE",
  "MINIOR_METEOR_INDIGO",
  "MINIOR_METEOR_VIOLET",
  "MINIOR_CORE",
  "MINIOR_CORE_ORANGE",
  "MINIOR_CORE_YELLOW",
  "MINIOR_CORE_GREEN",
  "MINIOR_CORE_BLUE",
  "MINIOR_CORE_INDIGO",
  "MINIOR_CORE_VIOLET",
  "ORICORIO_POM_POM",
  "ORICORIO_PAU",
  "ORICORIO_SENSU",
  "LYCANROC_MIDNIGHT",
  "LYCANROC_DUSK",
  "MIMIKYU_BUSTED",
  "NECROZMA_DUSK_MANE",
  "NECROZMA_DAWN_WINGS",
  "MAGEARNA_ORIGINAL_COLOR",
  "CRAMORANT_GORGING",
  "CRAMORANT_GULPING",
  "TOXTRICITY_LOW_KEY",
  "EISCUE_NOICE_FACE",
  "MORPEKO_HANGRY",
  "ZACIAN_CROWNED_SWORD",
  "ZAMAZENTA_CROWNED_SHIELD",
  "ETERNATUS_ETERNAMAX",
  "URSHIFU_RAPID_STRIKE_STYLE",
  "ZARUDE_DADA",
  "CALYREX_ICE_RIDER",
  "CALYREX_SHADOW_RIDER",
  "ENAMORUS_THERIAN",
  "MAUSHOLD_FOUR",
  "PALAFIN_HERO",
  "TATSUGIRI_DROOPY",
  "TATSUGIRI_STRETCHY",
  "GIMMIGHOUL_ROAMING",
  "OGERPON_WELLSPRING",
  "OGERPON_HEARTHFLAME",
  "OGERPON_CORNERSTONE",
  "ARCEUS_BUG",
  "ARCEUS_DARK",
  "ARCEUS_DRAGON",
  "ARCEUS_ELECTRIC",
  "ARCEUS_FAIRY",
  "ARCEUS_FIGHTING",
  "ARCEUS_FIRE",
  "ARCEUS_FLYING",
  "ARCEUS_GHOST",
  "ARCEUS_GRASS",
  "ARCEUS_GROUND",
  "ARCEUS_ICE",
  "ARCEUS_POISON",
  "ARCEUS_PSYCHIC",
  "ARCEUS_ROCK",
  "ARCEUS_STEEL",
  "ARCEUS_WATER",
  "SILVALLY_BUG",
  "SILVALLY_DARK",
  "SILVALLY_DRAGON",
  "SILVALLY_ELECTRIC",
  "SILVALLY_FAIRY",
  "SILVALLY_FIGHTING",
  "SILVALLY_FIRE",
  "SILVALLY_FLYING",
  "SILVALLY_GHOST",
  "SILVALLY_GRASS",
  "SILVALLY_GROUND",
  "SILVALLY_ICE",
  "SILVALLY_POISON",
  "SILVALLY_PSYCHIC",
  "SILVALLY_ROCK",
  "SILVALLY_STEEL",
  "SILVALLY_WATER",
  "UNOWN_B",
  "UNOWN_C",
  "UNOWN_D",
  "UNOWN_E",
  "UNOWN_F",
  "UNOWN_G",
  "UNOWN_H",
  "UNOWN_I",
  "UNOWN_J",
  "UNOWN_K",
  "UNOWN_L",
  "UNOWN_M",
  "UNOWN_N",
  "UNOWN_O",
  "UNOWN_P",
  "UNOWN_Q",
  "UNOWN_R",
  "UNOWN_S",
  "UNOWN_T",
  "UNOWN_U",
  "UNOWN_V",
  "UNOWN_W",
  "UNOWN_X",
  "UNOWN_Y",
  "UNOWN_Z",
  "UNOWN_EMARK",
  "UNOWN_QMARK",
  "ALCREMIE_CARAMEL_SWIRL",
  "ALCREMIE_LEMON_CREAM",
	"ALCREMIE_MATCHA_CREAM",
	"ALCREMIE_MINT_CREAM",
	"ALCREMIE_RAINBOW_SWIRL",
	"ALCREMIE_RUBY_CREAM",
	"ALCREMIE_RUBY_SWIRL",
	"ALCREMIE_SALTED_CREAM",
	"ALCREMIE_VANILLA_CREAM",
  "ALCREMIE_BERRY_CARAMEL_SWIRL",
	"ALCREMIE_BERRY_LEMON_CREAM",
	"ALCREMIE_BERRY_MATCHA_CREAM",
	"ALCREMIE_BERRY_MINT_CREAM",
	"ALCREMIE_BERRY_RAINBOW_SWIRL",
	"ALCREMIE_BERRY_RUBY_CREAM",
	"ALCREMIE_BERRY_RUBY_SWIRL",
	"ALCREMIE_BERRY_SALTED_CREAM",
	"ALCREMIE_BERRY_VANILLA_CREAM",
	"ALCREMIE_CLOVER_CARAMEL_SWIRL",
	"ALCREMIE_CLOVER_LEMON_CREAM",
	"ALCREMIE_CLOVER_MATCHA_CREAM",
	"ALCREMIE_CLOVER_MINT_CREAM",
	"ALCREMIE_CLOVER_RAINBOW_SWIRL",
	"ALCREMIE_CLOVER_RUBY_CREAM",
	"ALCREMIE_CLOVER_RUBY_SWIRL",
	"ALCREMIE_CLOVER_SALTED_CREAM",
	"ALCREMIE_CLOVER_VANILLA_CREAM",
	"ALCREMIE_FLOWER_CARAMEL_SWIRL",
	"ALCREMIE_FLOWER_LEMON_CREAM",
	"ALCREMIE_FLOWER_MATCHA_CREAM",
	"ALCREMIE_FLOWER_MINT_CREAM",
	"ALCREMIE_FLOWER_RAINBOW_SWIRL",
	"ALCREMIE_FLOWER_RUBY_CREAM",
	"ALCREMIE_FLOWER_RUBY_SWIRL",
	"ALCREMIE_FLOWER_SALTED_CREAM",
	"ALCREMIE_FLOWER_VANILLA_CREAM",
	"ALCREMIE_LOVE_CARAMEL_SWIRL",
	"ALCREMIE_LOVE_LEMON_CREAM",
	"ALCREMIE_LOVE_MATCHA_CREAM",
	"ALCREMIE_LOVE_MINT_CREAM",
	"ALCREMIE_LOVE_RAINBOW_SWIRL",
	"ALCREMIE_LOVE_RUBY_CREAM",
	"ALCREMIE_LOVE_RUBY_SWIRL",
	"ALCREMIE_LOVE_SALTED_CREAM",
	"ALCREMIE_LOVE_VANILLA_CREAM",
	"ALCREMIE_RIBBON_CARAMEL_SWIRL",
	"ALCREMIE_RIBBON_LEMON_CREAM",
	"ALCREMIE_RIBBON_MATCHA_CREAM",
	"ALCREMIE_RIBBON_MINT_CREAM",
	"ALCREMIE_RIBBON_RAINBOW_SWIRL",
	"ALCREMIE_RIBBON_RUBY_CREAM",
	"ALCREMIE_RIBBON_RUBY_SWIRL",
	"ALCREMIE_RIBBON_SALTED_CREAM",
	"ALCREMIE_RIBBON_VANILLA_CREAM",
	"ALCREMIE_STAR_CARAMEL_SWIRL",
	"ALCREMIE_STAR_LEMON_CREAM",
	"ALCREMIE_STAR_MATCHA_CREAM",
	"ALCREMIE_STAR_MINT_CREAM",
	"ALCREMIE_STAR_RAINBOW_SWIRL",
	"ALCREMIE_STAR_RUBY_CREAM",
	"ALCREMIE_STAR_RUBY_SWIRL",
	"ALCREMIE_STAR_SALTED_CREAM",
	"ALCREMIE_STAR_VANILLA_CREAM",
	"ALCREMIE_STRAWBERRY_CARAMEL_SWIRL",
	"ALCREMIE_STRAWBERRY_LEMON_CREAM",
	"ALCREMIE_STRAWBERRY_MATCHA_CREAM",
	"ALCREMIE_STRAWBERRY_MINT_CREAM",
	"ALCREMIE_STRAWBERRY_RAINBOW_SWIRL",
	"ALCREMIE_STRAWBERRY_RUBY_CREAM",
	"ALCREMIE_STRAWBERRY_RUBY_SWIRL",
	"ALCREMIE_STRAWBERRY_SALTED_CREAM",
  "FLABEBE_BLUE_FLOWER",
	"FLABEBE_ORANGE_FLOWER",
	"FLABEBE_RED_FLOWER",
	"FLABEBE_WHITE_FLOWER",
	"FLABEBE_YELLOW_FLOWER",
	"FLOETTE_BLUE_FLOWER",
	"FLOETTE_ORANGE_FLOWER",
	"FLOETTE_RED_FLOWER",
	"FLOETTE_WHITE_FLOWER",
	"FLOETTE_YELLOW_FLOWER",
	"FLORGES_BLUE_FLOWER",
	"FLORGES_ORANGE_FLOWER",
	"FLORGES_RED_FLOWER",
	"FLORGES_WHITE_FLOWER",
	"FLORGES_YELLOW_FLOWER",
];

const formsBlacklist = ["PORYGON_Z"];

const monsData = mons as PokemonInfo[];

function getMonsData() {
  return monsData.filter(({ species, flags }) => {
    return !(
      monsBlacklist.includes(species) ||
      species.endsWith("_FEMALE") ||
      flags.some((flag) =>
        [
          PokemonFlags.alolanForm,
          PokemonFlags.galarianForm,
          PokemonFlags.hisuianForm,
          PokemonFlags.paldeanForm,
        ].includes(flag),
      )
    );
  });
}
---

<Layout title="PokÃ¨mon">
  <ul id="pokemon-list" class="list-base">
    {
      getMonsData().map((mon) => (
        <PokemonComponent
          client:visible
          pokemon={mon}
          forms={monsData.filter(
            (m) =>
              m.species !== mon.species &&
              m.species.startsWith(`${mon.species}_`) &&
              !formsBlacklist.includes(m.species),
          )}
          learnset={getLearnset(mon.species)}
        />
      ))
    }
  </ul>
</Layout>

<script>
  import { updateList } from "../utils/search.utils";
  let pokemonArr: HTMLLIElement[] = [];
  document.addEventListener("DOMContentLoaded", () => {
    // Wait for React components to mount and render
    setTimeout(() => {
      const parent = document.getElementById("pokemon-list")!;
      const islands = Array.from(parent.querySelectorAll("astro-island")!);

      pokemonArr = islands.map((island) => {
        // Access the rendered content of each astro-island
        const content = island.shadowRoot
          ? island.shadowRoot.querySelector("*")
          : island.querySelector("*");
        return content as HTMLLIElement;
      });
    }, 0);
  });
  document.addEventListener("search", (ev) =>
    updateList(ev, pokemonArr, "data-name"),
  );
</script>

<!-- <script>
  import autoAnimate from "@formkit/auto-animate";
  const pokemonList = document.getElementById(
    "pokemon-list",
  ) as HTMLUListElement;
  autoAnimate(pokemonList);
  const pokemonArr = Array.from(pokemonList.children) as HTMLLIElement[];
  document.addEventListener("search", (event: Event) => {
    const searchText = (event as CustomEvent).detail.text.toUpperCase();
    pokemonList.innerHTML = "";
    pokemonArr.forEach((pokemonElement) => {
      const pokemonName = pokemonElement.getAttribute("data-pokemon-name")!;
      if (searchText !== "" && pokemonName.includes(searchText)) {
        pokemonList.appendChild(pokemonElement);
      }
    });
  });
</script> -->
