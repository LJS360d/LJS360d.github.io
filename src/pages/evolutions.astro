---
import type { EvolutionData } from "../models/types/evolution.data";
import evolutionsDiff from "../data/evolutions_diff.json";
import Layout from "../layouts/Layout.astro";
import EvolutionComponent from "../components/ui/evolution/EvolutionComponent";
const evolutionsData = evolutionsDiff as EvolutionData[];
---

<Layout title="Evolutions">
  <ul id="evolution-list" class="list-base">
    {evolutionsData.map((evo) => <EvolutionComponent evolution={evo} />)}
  </ul>
</Layout>

<script>
  const evolutionList = document.getElementById(
    "evolution-list",
  ) as HTMLUListElement;
  const evolutionArr = Array.from(evolutionList.children) as HTMLLIElement[];
  document.addEventListener("search", updateList);

  function updateList(event: Event) {
    const searchText = (event as CustomEvent).detail.text.toUpperCase();
    for (const evolutionElement of evolutionArr) {
      if (searchText === "") {
        evolutionElement.hidden = false;
        continue;
      }
      const evolutionNames = evolutionElement.getAttribute(
        "data-evolution-names",
      )!;
      evolutionElement.hidden = !evolutionNames.includes(searchText);
    }
  }
</script>
